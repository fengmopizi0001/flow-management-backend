# 流水管理系统

一个功能完整的流水管理系统，支持管理员导入Excel数据、客户标记流水状态，以及对账报表功能。

## 功能特性

### 管理员功能
- ✅ **仪表盘**：查看客户数量、已刷流水、总流水统计
- ✅ **导入Excel**：批量导入客户月度流水表（自动创建客户账户）
- ✅ **添加目标**：手动为客户设置月度流水目标
- ✅ **录入流水**：每日录入流水记录（自动创建当日汇总）
- ✅ **查看记录**：查看所有流水记录，支持按客户、日期筛选
- ✅ **对账报表**：按操作人、客户统计已刷流水

### 客户功能
- ✅ **仪表盘**：查看月度目标、完成进度、已刷/待刷流水
- ✅ **流水明细**：查看所有流水记录
- ✅ **标记流水**：勾选标记流水为"已刷"状态
- ✅ **操作人记录**：输入或选择刷流水的人（智能下拉菜单）
- ✅ **实时统计**：自动更新统计数据和进度条

### 移动端支持
- ✅ **响应式设计**：自动适配手机、平板、桌面
- ✅ **触摸优化**：大按钮、大复选框、触摸反馈
- ✅ **底部导航**：移动端专属底部导航栏
- ✅ **下拉刷新**：移动端支持下拉刷新页面
- ✅ **表格转卡片**：移动端表格自动转换为卡片视图

## 技术栈

- **前端**：HTML5 + CSS3 + JavaScript (原生)
- **后端**：Python + Flask
- **数据库**：SQLite (轻量级，无需额外安装)
- **Excel处理**：pandas + openpyxl

## 安装部署

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 运行系统

```bash
python app.py
```

系统将在 `http://localhost:5000` 启动

### 3. 访问系统

- 管理员登录：http://localhost:5000/login
  - 用户名：`admin`
  - 密码：`admin123`

## Excel格式要求

Excel文件需要符合以下格式：

### 表格结构
- **第一行标题**：`2026-01-27至2026-02-27   李先生流水表`
- **第二行表头**：`日期 | 交易1 | 交易2 | ... | 交易20 | 当日总计`
- **后续行**：每日流水明细
- **最后一行**：总计

### 示例格式
```
2026-01-27至2026-02-27   李先生流水表
日期    交易1    交易2    ...    交易20    当日总计
2026-01-27    126    104    ...    16397
2026-01-28    1508    136    ...    16014
...    ...
总计                                    504098
```

## 使用流程

### 管理员操作流程

1. **导入Excel**
   - 登录管理员账户
   - 点击"导入Excel"
   - 上传Excel文件
   - 系统自动创建客户账户（默认密码：123456）

2. **手动添加目标**（可选）
   - 如果没有Excel文件
   - 点击"添加目标"
   - 选择客户、设置年月、起始/结束日期、目标金额

3. **录入流水**
   - 点击"录入流水"
   - 选择客户、日期、金额
   - 系统自动创建当日汇总记录

4. **查看记录**
   - 点击"查看记录"
   - 按客户、日期筛选
   - 查看所有流水状态

5. **对账报表**
   - 点击"对账报表"
   - 查看按操作人统计
   - 查看按客户统计

### 客户操作流程

1. **登录**
   - 使用管理员创建的账户登录
   - 默认密码：123456（首次登录后建议修改）

2. **查看仪表盘**
   - 查看月度目标
   - 查看完成进度
   - 查看已刷/待刷流水

3. **标记流水**
   - 点击"流水明细"
   - 勾选流水记录
   - 输入或选择操作人
   - 系统自动更新统计

4. **筛选查看**
   - 按日期范围筛选
   - 按状态（待刷/已刷）筛选

## 文件结构

```
流水管理系统/
├── app.py                      # Flask主应用
├── requirements.txt             # Python依赖
├── README.md                  # 说明文档
├── data/
│   └── flow.db               # SQLite数据库
├── static/
│   ├── css/
│   │   └── style.css        # 响应式样式
│   └── js/
│       └── script.js        # JavaScript交互
└── templates/
    ├── base.html            # 基础模板
    ├── login.html           # 登录页面
    ├── admin/              # 管理员页面
    │   ├── dashboard.html
    │   ├── import_excel.html
    │   ├── add_target.html
    │   ├── add_record.html
    │   ├── view_records.html
    │   └── reconciliation.html
    └── customer/           # 客户页面
        ├── dashboard.html
        └── records.html
```

## 数据库结构

### users表（用户表）
- id: 主键
- username: 用户名（唯一）
- password_hash: 密码哈希
- role: 角色（admin/customer）
- created_at: 创建时间

### monthly_targets表（月度目标表）
- id: 主键
- customer_id: 客户ID（外键）
- year_month: 年月（如2026-01）
- start_date: 起始日期
- end_date: 结束日期
- target_amount: 目标金额
- created_at: 创建时间

### daily_records表（流水记录表）
- id: 主键
- customer_id: 客户ID（外键）
- date: 日期
- amount: 流水金额（单笔）
- daily_total: 当日总计
- status: 状态（pending/done）
- operator: 操作人
- is_daily_summary: 是否为汇总记录
- created_at: 创建时间
- updated_at: 更新时间

## 移动端特性

### 响应式断点
- **手机**：< 768px
- **平板**：768px - 1024px
- **桌面**：> 1024px

### 触摸优化
- 最小触摸目标：44x44px
- 大尺寸复选框：30x30px
- 触摸反馈效果
- 滑动手势支持
- 下拉刷新

### 导航
- 桌面端：顶部导航栏
- 移动端：底部导航栏（客户专属）

## 注意事项

1. **安全性**
   - 生产环境请修改 `app.py` 中的 `secret_key`
   - 建议为客户修改默认密码

2. **性能**
   - SQLite适合中小规模数据
   - 如需高并发，建议使用MySQL/PostgreSQL

3. **备份**
   - 定期备份 `data/flow.db` 文件
   - 导出的Excel文件请妥善保存

4. **兼容性**
   - 支持主流浏览器（Chrome、Firefox、Safari、Edge）
   - 移动端支持iOS Safari、Chrome Mobile

## 许可证

MIT License

## 联系方式

如有问题或建议，请联系管理员。
