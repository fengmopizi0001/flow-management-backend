{% extends "base.html" %}

{% block title %}æ“ä½œå‘˜ç®¡ç† - æµæ°´ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h2>ğŸ‘¥ æ“ä½œå‘˜ç®¡ç†</h2>
    </div>
    <div class="card-body">
        <!-- æ·»åŠ æ“ä½œå‘˜è¡¨å• -->
        <div class="content-section">
            <h3 class="section-title">æ·»åŠ æ–°æ“ä½œå‘˜</h3>
            <form id="addOperatorForm">
                <div class="form-group">
                    <label class="form-label" for="operatorName">æ“ä½œå‘˜å§“å *</label>
                    <input type="text" class="form-control" id="operatorName" placeholder="è¾“å…¥æ“ä½œå‘˜å§“å" required>
                </div>
                
                <button type="submit" class="btn btn-primary">â• æ·»åŠ æ“ä½œå‘˜</button>
            </form>
        </div>
        
        <!-- æ“ä½œå‘˜åˆ—è¡¨ -->
        {% if operators %}
        <div class="mt-5">
            <h3 class="section-title">æˆ‘çš„æ“ä½œå‘˜ <span style="font-size: 0.8rem; color: var(--gray-500);">ï¼ˆå…± {{ operators|length }} äººï¼‰</span></h3>
            
            <div class="operator-grid">
                {% for operator in operators %}
                <div class="operator-card">
                    <div class="operator-info">
                        <h4 class="operator-name">{{ operator.name }}</h4>
                    </div>
                    <button class="btn btn-sm btn-danger btn-operator-delete" onclick="deleteOperator({{ operator.id }})">åˆ é™¤</button>
                </div>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">ğŸ‘¥</div>
            <div class="empty-state-text">æš‚æ— æ“ä½œå‘˜</div>
            <p>æ·»åŠ æ‚¨çš„ç¬¬ä¸€ä¸ªæ“ä½œå‘˜å¼€å§‹ä½¿ç”¨</p>
            <div style="margin-top: 20px; padding: 15px; background: var(--primary-light); border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                <strong style="color: var(--primary-color);">ğŸ’¡ æç¤ºï¼š</strong>
                <div style="margin-top: 10px; color: var(--gray-700); line-height: 1.6;">
                    åœ¨ä¸Šæ–¹è¾“å…¥æ“ä½œå‘˜å§“åå¹¶ç‚¹å‡»"æ·»åŠ æ“ä½œå‘˜"æŒ‰é’®å³å¯åˆ›å»ºæ‚¨çš„æ“ä½œå‘˜åˆ—è¡¨ã€‚
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- è¿”å›æŒ‰é’® -->
        <div class="mt-4">
            <a href="{{ url_for('customer.dashboard') }}" class="btn btn-secondary btn-block-mobile">
                è¿”å›ä»ªè¡¨ç›˜
            </a>
        </div>
    </div>
</div>

<!-- æç¤ºä¿¡æ¯ -->
<div class="card mt-4">
    <div class="card-header">
        <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
    </div>
    <div class="card-body">
        <ul class="instruction-list">
            <li>åœ¨è¿™é‡Œæ·»åŠ æ‚¨å¸¸ç”¨çš„æ“ä½œå‘˜å§“åï¼ˆå¦‚ï¼šå¼ ä¸‰ã€æå››ç­‰ï¼‰</li>
            <li>åœ¨æ ‡è®°æµæ°´æ—¶ï¼Œå¯ä»¥ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©å·²ä¿å­˜çš„æ“ä½œå‘˜</li>
            <li>æ”¯ä»˜æ¸ é“ï¼ˆå¾®ä¿¡æ”¯ä»˜ã€æ”¯ä»˜å®ã€å…¶ä»–ï¼‰åœ¨æ ‡è®°æµæ°´æ—¶å•ç‹¬é€‰æ‹©</li>
            <li>ä¸é€‰æ‹©æ“ä½œå‘˜çš„æµæ°´å°†æ˜¾ç¤ºä¸º"æˆ‘è‡ªå·±æ“ä½œ"</li>
        </ul>
    </div>
</div>

<script>
// æ·»åŠ æ“ä½œå‘˜
document.getElementById('addOperatorForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const name = document.getElementById('operatorName').value.trim();
    
    if (!name) {
        alert('è¯·è¾“å…¥æ“ä½œå‘˜å§“å');
        return;
    }
    
    try {
        const response = await fetch('/customer/operators/add', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                name: name
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('æ“ä½œå‘˜æ·»åŠ æˆåŠŸï¼');
            location.reload();
        } else {
            alert('æ·»åŠ å¤±è´¥ï¼š' + result.error);
        }
    } catch (error) {
        alert('æ·»åŠ å¤±è´¥ï¼š' + error.message);
    }
});

// åˆ é™¤æ“ä½œå‘˜
async function deleteOperator(operatorId) {
    if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ“ä½œå‘˜å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤ï¼')) {
        return;
    }
    
    try {
        const response = await fetch(`/customer/operators/${operatorId}/delete`, {
            method: 'POST'
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('åˆ é™¤æˆåŠŸï¼');
            location.reload();
        } else {
            alert('åˆ é™¤å¤±è´¥ï¼š' + result.error);
        }
    } catch (error) {
        alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
    }
}

</script>
{% endblock %}
